import{d as m0}from"./el-button-BPh_G9Ns.js";import{E as v0}from"./el-empty-CTH9Xt6a.js";import{E as f0}from"./el-card-WJRpVXyY.js";import{d as g0}from"./el-scrollbar-ViEF51Jw.js";import{E as w0,a as x0}from"./el-select-D-jhMQjF.js";import{g as y0,a as _0,f as M0,b as b0}from"./deviceControl-1kflAKms.js";import{g as D0}from"./plantinstance-DQ3wuTUO.js";import{W as q,_ as C0,h as k0,g as p,c as H,E as B,U as z0,A as V0,a as g,j as x,w,I as S0,o as h,i as s,l as R,t as c,n as Y,F as E,k as F,b as j,x as J,e as T0,V as B0,m as E0}from"./index-DoZiZmvY.js";import{m as Z}from"./marked.esm-CZs8RSRt.js";import{f as F0,i as I0}from"./index-pfXhaCrA.js";import{E as L0}from"./index-CZqMsCSa.js";import{E as N0}from"./index-DA3cOSt1.js";import{a as G0,u as U0}from"./devicestatus-CXzmUSov.js";import"./index-C6vTP1ry.js";import"./index-CBLBCCTW.js";import"./isEqual-CGCEJ5oO.js";import"./index-Jp57_oih.js";import"./validator-CEVNRv68.js";const P0="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736960472033'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1007'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='320'%20height='320'%3e%3cpath%20d='M960%2031.9488h-896c-17.7152%200-31.9488%2014.336-31.9488%2031.9488V768c0%2017.7152%2014.336%2031.9488%2031.9488%2031.9488h384v192h128V799.9488h384c17.7152%200%2031.9488-14.336%2031.9488-31.9488V64c0.1024-17.7152-14.2336-32.0512-31.9488-32.0512z'%20fill='%23F0EEE2'%20p-id='1008'%3e%3c/path%3e%3cpath%20d='M64%20671.9488h896V768h-896z'%20fill='%23BBAA9C'%20p-id='1009'%3e%3c/path%3e%3cpath%20d='M399.9744%20527.9744h-128c-8.8064%200.2048-15.7696%207.5776-15.5648%2016.384%200.2048%208.4992%207.0656%2015.36%2015.5648%2015.5648h128c8.8064%200.2048%2016.1792-6.7584%2016.384-15.5648s-6.7584-16.1792-15.5648-16.384h-0.8192zM256%20688.0256h-48.0256c-8.8064%200.2048-15.7696%207.5776-15.5648%2016.384%200.2048%208.4992%207.0656%2015.36%2015.5648%2015.5648H256c8.8064-0.2048%2015.7696-7.5776%2015.5648-16.384-0.2048-8.4992-7.0656-15.36-15.5648-15.5648z%20m608.0512%2015.9744h-79.9744c-8.8064%200-15.9744%207.168-15.9744%2015.9744s7.168%2015.9744%2015.9744%2015.9744h79.9744c8.8064%200%2015.9744-7.168%2015.9744-15.9744s-7.168-15.9744-15.9744-15.9744zM496.0256%20176.0256h-64c-8.8064%200.2048-15.7696%207.5776-15.5648%2016.384%200.2048%208.4992%207.0656%2015.36%2015.5648%2015.5648h64c8.8064-0.2048%2015.7696-7.5776%2015.5648-16.384-0.2048-8.4992-7.0656-15.36-15.5648-15.5648z%20m479.9488%20111.9232h-96.0512c-8.8064%200-15.9744%207.168-15.9744%2015.9744s7.168%2015.9744%2015.9744%2015.9744h96.0512c8.8064%200%2015.9744-7.168%2015.9744-15.9744s-7.0656-15.9744-15.9744-15.9744zM799.9488%20463.9744c0-8.8064-7.168-15.9744-15.9744-15.9744h-31.9488c-8.8064%200.2048-15.7696%207.5776-15.5648%2016.384%200.2048%208.4992%207.0656%2015.36%2015.5648%2015.5648h31.9488c8.9088%200.1024%2015.9744-7.0656%2015.9744-15.9744z%20m-559.9232-128c0-8.8064-7.168-15.9744-15.9744-15.9744h-64c-8.8064%200.2048-15.7696%207.5776-15.5648%2016.384%200.2048%208.4992%207.0656%2015.36%2015.5648%2015.5648h64c8.8064%200.1024%2015.9744-7.0656%2015.9744-15.9744z%20m543.9488-159.9488c8.8064%200%2015.9744-7.168%2015.9744-15.9744s-7.168-15.9744-15.9744-15.9744h-48.0256c-8.8064%200-15.9744%207.168-15.9744%2015.9744s7.168%2015.9744%2015.9744%2015.9744h48.0256zM543.9488%20384c-8.8064%200-15.9744%207.168-15.9744%2015.9744s7.168%2015.9744%2015.9744%2015.9744%2015.9744-7.168%2015.9744-15.9744c0.1024-8.8064-7.0656-15.9744-15.9744-15.9744z'%20fill='%23D8D5BA'%20p-id='1010'%3e%3c/path%3e%3cpath%20d='M512%20752.0256c17.7152%200%2031.9488-14.336%2031.9488-31.9488S529.6128%20688.128%20512%20688.128s-31.9488%2014.336-31.9488%2031.9488%2014.2336%2031.9488%2031.9488%2031.9488zM960%200h-896C28.672%200%200%2028.672%200%2064V768c0%2035.328%2028.672%2064%2064%2064h352.0512s0%20128-64%20128h-31.9488c-17.7152%200-31.9488%2014.336-31.9488%2031.9488s14.336%2031.9488%2031.9488%2031.9488h384c17.7152%200%2031.9488-14.336%2031.9488-31.9488s-14.336-31.9488-31.9488-31.9488h-31.9488c-64%200-64-128-64-128h352.0512c35.328%200%2064-28.672%2064-64V64C1024%2028.672%20995.328%200%20960%200zM451.7888%20960c19.7632-36.7616%2028.2624-84.1728%2028.2624-128h64c0%2043.8272%208.3968%2091.2384%2028.2624%20128H451.7888zM960%20768h-896v-96.0512h896V768z%20m0-128h-896V64h896V640z'%20fill='%235F4E56'%20p-id='1011'%3e%3c/path%3e%3c/svg%3e",A0="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1737016572755'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1040'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='320'%20height='320'%3e%3cpath%20d='M745.472%20976H240c-114.688%200-207.744-93.056-207.744-207.744V262.784C32.256%20148.096%20125.312%2055.04%20240%2055.04h505.472c114.688%200%20207.744%2093.056%20207.744%20207.744v505.472c0%20114.688-93.056%20207.744-207.744%20207.744z'%20fill='%2300A9FA'%20p-id='1041'%3e%3c/path%3e%3cpath%20d='M350.08%20480.512c3.456-69.76%2055.424-126.336%20122.752-137.6-25.984-49.28-77.696-82.944-137.344-82.944-85.76%200-155.264%2069.504-155.264%20155.264%200%2061.312%2035.584%20114.176%2087.168%20139.392%2013.824-36.352%2044.544-64.256%2082.688-74.112z'%20fill='%23FFCA33'%20p-id='1042'%3e%3c/path%3e%3cpath%20d='M665.6%20438.528c-9.728%200-19.328%201.024-28.544%202.944-19.456-58.624-74.752-100.864-139.904-100.864-8.32%200-16.384%201.024-24.32%202.432%2011.392%2021.632%2017.92%2046.208%2017.92%2072.32%200%2085.76-69.504%20155.264-155.264%20155.264-24.448%200-47.488-5.76-68.096-15.872-4.992%2013.184-7.936%2027.52-7.936%2042.496%200%2066.816%2054.144%20120.832%20120.832%20120.832H665.6c77.184%200%20139.776-62.592%20139.776-139.776S742.784%20438.528%20665.6%20438.528z'%20fill='%23DBEEF7'%20p-id='1043'%3e%3c/path%3e%3cpath%20d='M490.752%20415.232c0-26.112-6.528-50.688-17.92-72.32-67.328%2011.264-119.296%2067.968-122.752%20137.6-38.144%209.856-68.864%2037.76-82.688%2074.112%2020.608%2010.112%2043.648%2015.872%2068.096%2015.872%2085.76%200%20155.264-69.504%20155.264-155.264z'%20fill='%23FFFAE1'%20p-id='1044'%3e%3c/path%3e%3c/svg%3e",O0=()=>q.get("/weatherNow"),$0=()=>q.get("/weather"),W0="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='26.75'%20x2='37.25'%20y1='22.91'%20y2='41.09'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23fbbf24'/%3e%3cstop%20offset='.45'%20stop-color='%23fbbf24'/%3e%3cstop%20offset='1'%20stop-color='%23f59e0b'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='32'%20cy='32'%20r='10.5'%20fill='url(%23a)'%20stroke='%23f8af18'%20stroke-miterlimit='10'%20stroke-width='.5'/%3e%3cpath%20fill='none'%20stroke='%23fbbf24'%20stroke-linecap='round'%20stroke-miterlimit='10'%20stroke-width='3'%20d='M32%2015.71V9.5m0%2045v-6.21m11.52-27.81l4.39-4.39M16.09%2047.91l4.39-4.39m0-23l-4.39-4.39m31.82%2031.78l-4.39-4.39M15.71%2032H9.5m45%200h-6.21'%3e%3canimateTransform%20attributeName='transform'%20dur='45s'%20repeatCount='indefinite'%20type='rotate'%20values='0%2032%2032;%20360%2032%2032'/%3e%3c/path%3e%3c/svg%3e",H0="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='22.56'%20x2='39.2'%20y1='21.96'%20y2='50.8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23f3f7fe'/%3e%3cstop%20offset='.45'%20stop-color='%23f3f7fe'/%3e%3cstop%20offset='1'%20stop-color='%23deeafb'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20fill='url(%23a)'%20stroke='%23e6effc'%20stroke-miterlimit='10'%20stroke-width='.5'%20d='M46.5%2031.5h-.32a10.49%2010.49%200%2000-19.11-8%207%207%200%2000-10.57%206%207.21%207.21%200%2000.1%201.14A7.5%207.5%200%200018%2045.5a4.19%204.19%200%2000.5%200v0h28a7%207%200%20000-14z'%3e%3canimateTransform%20attributeName='transform'%20dur='7s'%20repeatCount='indefinite'%20type='translate'%20values='-3%200;%203%200;%20-3%200'/%3e%3c/path%3e%3c/svg%3e",R0="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%2064%2064'%3e%3cdefs%3e%3clinearGradient%20id='b'%20x1='22.56'%20x2='39.2'%20y1='21.96'%20y2='50.8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23f3f7fe'/%3e%3cstop%20offset='.45'%20stop-color='%23f3f7fe'/%3e%3cstop%20offset='1'%20stop-color='%23deeafb'/%3e%3c/linearGradient%3e%3clinearGradient%20id='a'%20x1='22.53'%20x2='25.47'%20y1='42.95'%20y2='48.05'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%234286ee'/%3e%3cstop%20offset='.45'%20stop-color='%234286ee'/%3e%3cstop%20offset='1'%20stop-color='%230950bc'/%3e%3c/linearGradient%3e%3clinearGradient%20id='c'%20x1='29.53'%20x2='32.47'%20y1='42.95'%20y2='48.05'%20xlink:href='%23a'/%3e%3clinearGradient%20id='d'%20x1='36.53'%20x2='39.47'%20y1='42.95'%20y2='48.05'%20xlink:href='%23a'/%3e%3c/defs%3e%3cpath%20fill='url(%23b)'%20stroke='%23e6effc'%20stroke-miterlimit='10'%20stroke-width='.5'%20d='M46.5%2031.5h-.32a10.49%2010.49%200%2000-19.11-8%207%207%200%2000-10.57%206%207.21%207.21%200%2000.1%201.14A7.5%207.5%200%200018%2045.5a4.19%204.19%200%2000.5%200v0h28a7%207%200%20000-14z'/%3e%3cpath%20fill='none'%20stroke='url(%23a)'%20stroke-linecap='round'%20stroke-miterlimit='10'%20stroke-width='2'%20d='M24.39%2043.03l-.78%204.94'%3e%3canimateTransform%20attributeName='transform'%20dur='0.7s'%20repeatCount='indefinite'%20type='translate'%20values='1%20-5;%20-2%2010'/%3e%3canimate%20attributeName='opacity'%20dur='0.7s'%20repeatCount='indefinite'%20values='0;1;1;0'/%3e%3c/path%3e%3cpath%20fill='none'%20stroke='url(%23c)'%20stroke-linecap='round'%20stroke-miterlimit='10'%20stroke-width='2'%20d='M31.39%2043.03l-.78%204.94'%3e%3canimateTransform%20attributeName='transform'%20begin='-0.4s'%20dur='0.7s'%20repeatCount='indefinite'%20type='translate'%20values='1%20-5;%20-2%2010'/%3e%3canimate%20attributeName='opacity'%20begin='-0.4s'%20dur='0.7s'%20repeatCount='indefinite'%20values='0;1;1;0'/%3e%3c/path%3e%3cpath%20fill='none'%20stroke='url(%23d)'%20stroke-linecap='round'%20stroke-miterlimit='10'%20stroke-width='2'%20d='M38.39%2043.03l-.78%204.94'%3e%3canimateTransform%20attributeName='transform'%20begin='-0.2s'%20dur='0.7s'%20repeatCount='indefinite'%20type='translate'%20values='1%20-5;%20-2%2010'/%3e%3canimate%20attributeName='opacity'%20begin='-0.2s'%20dur='0.7s'%20repeatCount='indefinite'%20values='0;1;1;0'/%3e%3c/path%3e%3c/svg%3e",Y0="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='16.5'%20x2='21.5'%20y1='19.67'%20y2='28.33'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23fbbf24'/%3e%3cstop%20offset='.45'%20stop-color='%23fbbf24'/%3e%3cstop%20offset='1'%20stop-color='%23f59e0b'/%3e%3c/linearGradient%3e%3clinearGradient%20id='b'%20x1='22.56'%20x2='39.2'%20y1='21.96'%20y2='50.8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23f3f7fe'/%3e%3cstop%20offset='.45'%20stop-color='%23f3f7fe'/%3e%3cstop%20offset='1'%20stop-color='%23deeafb'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='19'%20cy='24'%20r='5'%20fill='url(%23a)'%20stroke='%23f8af18'%20stroke-miterlimit='10'%20stroke-width='.5'/%3e%3cpath%20fill='none'%20stroke='%23fbbf24'%20stroke-linecap='round'%20stroke-miterlimit='10'%20stroke-width='2'%20d='M19%2015.67V12.5m0%2023v-3.17m5.89-14.22l2.24-2.24M10.87%2032.13l2.24-2.24m0-11.78l-2.24-2.24m16.26%2016.26l-2.24-2.24M7.5%2024h3.17m19.83%200h-3.17'%3e%3canimateTransform%20attributeName='transform'%20dur='45s'%20repeatCount='indefinite'%20type='rotate'%20values='0%2019%2024;%20360%2019%2024'/%3e%3c/path%3e%3cpath%20fill='url(%23b)'%20stroke='%23e6effc'%20stroke-miterlimit='10'%20stroke-width='.5'%20d='M46.5%2031.5h-.32a10.49%2010.49%200%2000-19.11-8%207%207%200%2000-10.57%206%207.21%207.21%200%2000.1%201.14A7.5%207.5%200%200018%2045.5a4.19%204.19%200%2000.5%200v0h28a7%207%200%20000-14z'/%3e%3c/svg%3e",j0={class:"home-container"},J0={class:"card-header"},Z0={class:"header-right"},q0={class:"device-selector"},K0={class:"monitor-grid"},Q0={class:"monitor-item weather-item"},X0={class:"weather-content"},e2={class:"weather-info"},t2={class:"main-info"},a2={class:"temperature"},s2={class:"weather-text"},o2={class:"weather"},i2=["src"],l2={class:"weather-details"},r2={class:"detail-item"},n2={class:"value"},c2={class:"detail-item"},d2={class:"value"},u2={class:"forecast"},p2={class:"forecast-date"},h2={class:"date"},m2={class:"forecast-weather"},v2={class:"day"},f2={class:"text"},g2={class:"night"},w2={class:"text"},x2={class:"forecast-data"},y2={class:"temp"},_2={class:"high"},M2={class:"low"},b2={class:"extra-info"},D2={class:"humidity"},C2={class:"precip"},k2=["onClick"],z2={class:"item-content"},V2={class:"item-header"},S2={class:"label-wrapper"},T2=["src","alt"],B2={class:"label"},E2={class:"value-container"},F2={class:"value-wrapper"},I2={class:"value"},L2={class:"unit"},N2={class:"progress-wrapper"},G2={class:"progress-bar"},U2={class:"range-text"},P2={class:"card-header"},A2={key:1,id:"environmentChart",style:{width:"100%",height:"600px"}},O2={__name:"HomePage",emits:["update-abnormal"],setup($2,{emit:K}){const U=k0(),f=G0(),I=U0(),y=p("1号"),_=p([]),m=p(""),v=p({current:{temp:"--",weather:"--",humidity:"--",windSpeed:"--",windDir:"--"},forecast:[]}),n=H(()=>f.monitorData),V=p([]),b=p("temperature"),P=[{label:"温度",value:"temperature",unit:"°C",color:"#FF6B6B",gradientColors:["rgba(255, 107, 107, 0.3)","rgba(255, 107, 107, 0.1)"]},{label:"湿度",value:"humidity",unit:"%",color:"#4ECDC4",gradientColors:["rgba(78, 205, 196, 0.3)","rgba(78, 205, 196, 0.1)"]},{label:"土壤湿度",value:"soilMoisture",unit:"%",color:"#45B7D1",gradientColors:["rgba(69, 183, 209, 0.3)","rgba(69, 183, 209, 0.1)"]},{label:"CO2浓度",value:"co2Concentration",unit:"pm",color:"#96CEB4",gradientColors:["rgba(150, 206, 180, 0.3)","rgba(150, 206, 180, 0.1)"]},{label:"光照强度",value:"lightIntensity",unit:"Lx",color:"#FFAD60",gradientColors:["rgba(255, 173, 96, 0.3)","rgba(255, 173, 96, 0.1)"]}],S=p("离线"),Q=async()=>{try{const e=await y0(U.user.id);if(e.data.code==="1"){const t=e.data.data.map(i=>({id:i.id,plantId:i.plantInstanceId,displayId:i.name,name:i.name}));_.value=t;const a=I.currentDevice,r=_.value.find(i=>i.name===a);if(a&&r)y.value=a,m.value=a;else if(t.length>0){const i=t[0].name;y.value=i,m.value=i,I.setCurrentDevice(i)}T()}}catch(e){console.error("获取设备信息失败:",e)}},T=async()=>{try{const e=await _0(m.value);e.data.code==="1"&&(S.value=e.data.data==="ONLINE"?"在线":"离线",console.log("设备状态：",m.value,S.value))}catch(e){console.error("获取设备状态失败:",e)}},A=async e=>{I.setCurrentDevice(e),y.value=e,m.value=e;const t=_.value.find(a=>a.name===e);t&&(await T(),await t0(t.id),u&&clearInterval(u),u=setInterval(()=>{L(),T()},2e3))},L=async()=>{try{const e=await M0(m.value);if(e.data.code==="1"){const t=e.data.data.body.data.list.propertyStatusInfo;console.log(t);const a=C(t,"Temperature");if(console.log(a),a){const l=parseFloat(a.value);console.log(l),isNaN(l)||(f.updateMonitorData("temperature",l),D("temperature",l))}const r=C(t,"EnvironmentHumidity");if(r){const l=parseFloat(r.value);isNaN(l)||(f.updateMonitorData("humidity",l),D("humidity",l))}const i=C(t,"SoilMoisture");if(i){const l=parseFloat(i.value);isNaN(l)||(f.updateMonitorData("soilMoisture",l),D("soilMoisture",l))}const M=C(t,"CO2Value");if(M){const l=parseFloat(M.value);isNaN(l)||(f.updateMonitorData("co2",l),D("co2",l))}const d=C(t,"LightLux");if(d){const l=parseFloat(d.value);isNaN(l)||(f.updateMonitorData("lightLux",l),D("lightLux",l))}}}catch(e){console.error("获取设备数据失败:",e)}},D=(e,t)=>{const a=n.value[e],r=parseFloat(t);r<a.min?f.updateMonitorStatus(e,"low"):r>a.max?f.updateMonitorStatus(e,"high"):f.updateMonitorStatus(e,"normal")},C=(e,t)=>e.find(a=>a.identifier===t);let u=null;const X=async()=>{try{const e=await O0();if(e.data.code==="200"){const a=e.data.now;v.value.current={temp:a.temp,weather:a.text,humidity:a.humidity,windSpeed:"--",windDir:a.windDir}}const t=await $0();t.data.code==="200"&&(v.value.forecast=t.data.daily.map(a=>({date:e0(a.fxDate),dayWeather:a.textDay,nightWeather:a.textNight,dayTemp:a.tempMax,nightTemp:a.tempMin,humidity:a.humidity,precip:a.precip})))}catch(e){console.error("获取天气数据失败:",e)}},e0=e=>{const t=new Date(e),a=t.getMonth()+1,r=t.getDate();return`${a}/${r}`},t0=async e=>{try{const t=await b0(e);if(t.data.code==="1"){const a=t.data.data;n.value.temperature.range=`${a.temperatureMin}°C-${a.temperatureMax}°C`,n.value.temperature.min=a.temperatureMin,n.value.temperature.max=a.temperatureMax,n.value.humidity.range=`${a.humidityMin}%-${a.humidityMax}%`,n.value.humidity.min=a.humidityMin,n.value.humidity.max=a.humidityMax,n.value.soilMoisture.range=`${a.soilMoistureMin}%-${a.soilMoistureMax}%`,n.value.soilMoisture.min=a.soilMoistureMin,n.value.soilMoisture.max=a.soilMoistureMax,n.value.co2.range=`${a.co2Min}pm-${a.co2Max}pm`,n.value.co2.min=a.co2Min,n.value.co2.max=a.co2Max,n.value.lightLux.range=`${a.lightIntensityMin}Lx-${a.lightIntensityMax}Lx`,n.value.lightLux.min=a.lightIntensityMin,n.value.lightLux.max=a.lightIntensityMax}}catch(t){console.error("获取设备阈值失败:",t)}},O=async()=>{try{const e=_.value.find(t=>t.displayId===y.value);if(e){const t=await F0(e.plantId);t.data.code==="1"&&(V.value=t.data.data,S0(()=>{$()}))}}catch(e){console.error("获取历史数据失败:",e)}},$=()=>{const e=document.getElementById("environmentChart"),t=I0(e),a=[...V.value].sort((d,l)=>new Date(d.recordedTime)-new Date(l.recordedTime)),r=a.map(d=>d.recordedTime.split(" ")[0]),i=P.find(d=>d.value===b.value),M={title:{text:`七天${i.label}趋势图(每日12点左右)`,left:"center"},tooltip:{trigger:"axis",formatter:function(d){const l=d[0];return`${l.axisValue}<br/>${i.label}: ${l.value}${i.unit}`}},grid:{left:"3%",right:"4%",bottom:"10%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:r,axisLabel:{rotate:45}},yAxis:{type:"value",name:i.label,axisLabel:{formatter:`{value}${i.unit}`}},series:[{name:i.label,type:"line",data:a.map(d=>d[b.value]),smooth:!0,showSymbol:!1,lineStyle:{color:i.color,width:3},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:i.gradientColors[0]},{offset:1,color:i.gradientColors[1]}]}}}]};t.setOption(M)};B(b,()=>{V.value.length>0&&$()}),B(y,()=>{O()});const a0=B0();B(()=>a0.fullPath,(e,t)=>{console.log("路由变化:",t,"->",e),e.startsWith("/home")||(console.log("离开首页，清除定时器"),u&&(clearInterval(u),u=null))},{immediate:!0}),z0(()=>{console.log("组件卸载，清除定时器"),u&&(clearInterval(u),u=null)});const s0=()=>{console.log("设置定时器"),u&&clearInterval(u),u=setInterval(()=>{L(),T()},2e3)};V0(async()=>{await Q(),m.value&&await A(m.value),L(),s0(),X(),O()});const o0=K,i0=()=>{const e=Object.values(n.value).some(t=>t.status!=="normal");return o0("update-abnormal",e),e};B(n,()=>{i0()},{deep:!0});const l0=e=>({normal:"success",high:"danger",low:"warning"})[e],r0=e=>({normal:"正常",high:"偏高",low:"偏低"})[e],n0=(e,t,a)=>{const r=parseFloat(e);return isNaN(r)?0:((Math.max(t,Math.min(a,r))-t)/(a-t)*100).toFixed(1)},W=e=>{switch(e){case"low":return"exception";case"high":return"warning";default:return"success"}},c0=E0(),d0=e=>{e.status!=="normal"&&c0.push("/control")},u0=e=>({temperature:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736960492302'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1328'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='320'%20height='320'%3e%3cpath%20d='M671.996%20568.336V160c0-88.368-71.648-160-160-160C423.628%200%20351.996%2071.632%20351.996%20160v408.336C293.516%20615.248%20255.996%20687.2%20255.996%20768c0%20141.376%20114.608%20255.984%20256%20255.984%20141.376%200%20256-114.608%20256-255.984%200-80.8-37.536-152.752-96-199.664z'%20fill='%23FFFFFF'%20p-id='1329'%3e%3c/path%3e%3cpath%20d='M671.996%20568.336V160c0-88.368-71.648-160-160-160C423.628%200%20351.996%2071.632%20351.996%20160v408.336C293.516%20615.248%20255.996%20687.2%20255.996%20768c0%20141.376%20114.608%20255.984%20256%20255.984%20141.376%200%20256-114.608%20256-255.984%200-80.8-37.536-152.752-96-199.664zM511.996%20960.416C405.708%20960.416%20319.58%20874.272%20319.58%20768c0-71.248%2038.864-133.168%2096.416-166.384V160a96%2096%200%201%201%20192%200v441.632c57.552%2033.216%2096.4%2095.136%2096.4%20166.368%200%20106.272-86.128%20192.416-192.4%20192.416z'%20fill='%23CCCCCC'%20p-id='1330'%3e%3c/path%3e%3cpath%20d='M543.996%20644.192V479.984a32%2032%200%200%200-64%200v164.208c-55.184%2014.224-96%2064.192-96%20123.808a128%20128%200%201%200%20256%200c0-59.616-40.832-109.568-96-123.808z'%20fill='%2388C057'%20p-id='1331'%3e%3c/path%3e%3c/svg%3e",import.meta.url).href,humidity:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736960500305'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1491'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='320'%20height='320'%3e%3cpath%20d='M542.293333%20481.706667a42.666667%2042.666667%200%200%200-60.586666%200l-106.666667%20106.666666a193.706667%20193.706667%200%201%200%20273.92%200z'%20fill='%23309FFB'%20p-id='1492'%3e%3c/path%3e%3cpath%20d='M840.96%20225.706667l-85.333333-85.333334a42.666667%2042.666667%200%200%200-60.586667%200l-85.333333%2085.333334a163.413333%20163.413333%200%201%200%20231.253333%200z'%20fill='%2369B9FB'%20p-id='1493'%3e%3c/path%3e%3cpath%20d='M389.12%20426.666667a132.693333%20132.693333%200%200%200-38.826667-94.293334l-64-64a42.666667%2042.666667%200%200%200-60.586666%200l-64%2064A133.546667%20133.546667%200%201%200%20389.12%20426.666667z'%20fill='%2388C7FB'%20p-id='1494'%3e%3c/path%3e%3cpath%20d='M512%20918.613333a193.28%20193.28%200%200%201-136.96-330.24l106.666667-106.666666a42.666667%2042.666667%200%200%201%2060.586666%200l106.666667%20106.666666A193.28%20193.28%200%200%201%20512%20918.613333z%20m0-346.453333l-76.373333%2076.8a107.946667%20107.946667%200%201%200%20152.746666%200zM725.333333%20504.746667a163.413333%20163.413333%200%200%201-115.626666-279.04l85.333333-85.333334a42.666667%2042.666667%200%200%201%2060.586667%200l85.333333%2085.333334A163.413333%20163.413333%200%200%201%20725.333333%20504.746667z%20m0-273.92l-55.04%2055.466666a77.653333%2077.653333%200%201%200%20110.08%200zM256%20559.786667a133.546667%20133.546667%200%200%201-94.293333-227.413334l64-64a42.666667%2042.666667%200%200%201%2060.586666%200l64%2064A133.12%20133.12%200%200%201%20256%20559.786667z%20m0-200.96l-33.706667%2034.133333a47.786667%2047.786667%200%201%200%2067.413334%200z'%20fill='%23486675'%20p-id='1495'%3e%3c/path%3e%3c/svg%3e",import.meta.url).href,soilMoisture:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736960483426'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1171'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='320'%20height='320'%3e%3cpath%20d='M689.798887%20917.281268l-178.510879-59.179296-184.142811%2059.179296-189.774745-61.926264%2014.085833-38.537542%20175.688912%2056.41933%20184.142811-59.166297%20178.510879%2059.166297%20182.731828-56.41933%2014.099833%2038.537542L689.797887%20917.281268zM520.079904%20775.470954c-160.429093%200-290.837543-121.354558-290.837543-270.681783%200-62.014263%2045.267462-161.690078%20138.100358-304.911377C434.938916%2096.079028%20501.02313%2011.302036%20503.708099%207.718078A21.04175%2021.04175%200%200%201%20520.079904%200.00017c6.542922%200%2012.511851%202.871966%2016.370805%207.717908%202.684968%203.583957%2068.944181%2088.548948%20136.165382%20192.159716%2093.020894%20143.0333%20138.301356%20242.897113%20138.301356%20304.911377%200%20149.327225-130.40845%20270.681783-290.837543%20270.681783z%20m118.258594-555.688396A3045.226808%203045.226808%200%200%200%20535.862716%2072.416309L520.079904%2050.912565l-15.784812%2021.503744c-25.624695%2034.789587-64.149238%2088.38795-102.473783%20147.366249-109.204702%20168.134002-132.13143%20247.718056-132.131429%20285.006613%200%20128.522473%20112.288665%20233.207228%20250.390024%20233.207228%20138.088359%200%20250.564022-104.684756%20250.377024-233.207228%200-37.288557-22.914728-116.872611-132.11843-285.006613zM473.087462%20655.002385a17.607791%2017.607791%200%200%201-8.091903-1.784978c-3.084963-1.435983-76.262094-37.275557-94.568876-106.482735-26.96068-102.698779%2036.014572-167.609008%2038.711539-170.293976a17.894787%2017.894787%200%200%201%2012.512852-5.369936h0.773991c4.419947%200%208.865895%201.610981%2012.137855%204.469947%207.117915%206.269925%207.704908%2016.671802%200.961989%2023.489721-2.122975%202.135975-52.399377%2055.383342-30.245641%20139.824338%2014.260831%2054.309355%2075.513103%2084.416997%2076.075096%2084.778992%208.865895%204.307949%2012.137856%2014.348829%207.716909%2022.402734-3.059964%205.469935-9.22789%208.928894-15.983811%208.965893zM265.643928%20955.105819l-67.833194%2067.246201-30.132642-28.959656%2067.833194-67.245201%2030.132642%2028.959656z%20m147.953241%201.897977l-68.544185%2066.572209-29.870645-29.209653%2068.532186-66.546209%2029.882644%2029.183653z%20m148.928231%200l-68.545186%2066.572209-29.907644-29.209653%2068.544185-66.546209%2029.908645%2029.183653z%20m148.89023%200l-68.532186%2066.572209L612.9988%20994.366352l68.545185-66.546209%2029.869645%2029.183653z%20m148.578234%200.424995l-68.545185%2066.571209-29.907645-29.207653%2068.544186-66.547209%2029.908644%2029.183653z'%20fill='%23B2B6BD'%20p-id='1172'%3e%3c/path%3e%3c/svg%3e",import.meta.url).href,co2:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736960506039'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1655'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='320'%20height='320'%3e%3cpath%20d='M886.3%20474.5c-38-38-86.6-61.7-139.1-68.4-3.6-67.6-31.2-130.7-78.8-179-51.2-52.1-119.4-80.8-192-80.8s-140.8%2028.7-192%2080.8c-51%2051.9-79.2%20120.8-79.2%20194.1%200%201.9%200%203.8%200.1%205.8-36.9%2017.4-68.7%2043.8-92.8%2077.4-29.4%2040.9-44.9%2089.3-44.9%20139.8%200%2064.1%2025%20124.4%2070.3%20169.8%2045.3%2045.3%20105.6%2070.3%20169.8%2070.3h408.8c64.1%200%20124.4-25%20169.8-70.3%2045.3-45.3%2070.3-105.6%2070.3-169.8s-25-124.3-70.3-169.7zM716.5%20794.4H307.7c-82.8%200-150.1-67.3-150.1-150.1%200-63.3%2040-120.1%2099.7-141.4%2025.8-9.2%2041.8-34.7%2039-62-0.7-6.5-1-13-1-19.6%200-102%2081.3-184.9%20181.1-184.9s181.1%2083%20181.1%20184.9c0%203.4-0.1%206.9-0.3%2010.3-0.9%2016.2%205%2032.3%2016.2%2044.1%2011.1%2011.8%2026.8%2018.5%2043%2018.5%2082.8%200%20150.1%2067.3%20150.1%20150.1s-67.2%20150.1-150%20150.1z'%20p-id='1656'%3e%3c/path%3e%3cpath%20d='M412.9%20667.8c-11.4%2012.4-24.5%2018.7-38.8%2018.7-29.3%200-46.7-24.3-46.7-65%200-37.7%2019.5-64.1%2047.3-64.1%2012.5%200%2022.8%204.7%2035.5%2016.1l3.9%203.5%2033.9-41.6-3.1-3.2c-11.2-11.4-35.3-30.5-71.1-30.5-30%200-57.6%2011.4-77.8%2032-21.8%2022.2-33.3%2053.2-33.3%2089.6%200%2036.8%2011.2%2067.5%2032.4%2088.9%2019.4%2019.6%2046.8%2030.3%2076.9%2030.3%2030.5%200%2056.9-12%2076.4-34.6l2.8-3.2-34.5-41.1-3.8%204.2z'%20p-id='1657'%3e%3c/path%3e%3cpath%20d='M556.2%20501.8c-31.7%200-58.5%2010.8-77.4%2031.4-19.3%2021-29.5%2051.4-29.5%2087.8%200%2073.9%2042%20121.6%20106.9%20121.6%2065%200%20106.9-47.7%20106.9-121.6%200-36.4-10.2-66.7-29.5-87.7-18.9-20.6-45.7-31.5-77.4-31.5z%20m0%20184.8c-26.1%200-42.2-25.1-42.2-65.6%200-39.7%2015.8-63.5%2042.2-63.5%2026.6%200%2042.5%2023.7%2042.5%2063.5%200.1%2040.4-16.2%2065.6-42.5%2065.6zM731.2%20706.2c13.7-15.2%2025.9-31.9%2025.9-48.4%200-23.5-17.1-40-41.5-40-16.2%200-27.9%205.4-40.5%2018.7l-3.4%203.6%2021.5%2021.3%203.5-3.5c5.1-5.1%209.8-9.3%2015.3-9.3%204.1%200%209.5%201.1%209.5%2010.7%200%2013.3-20.8%2032.8-44.9%2055.2L675%20716v22.4h87.1V706h-25.5c-1.6%200-3.5%200.1-5.4%200.2z'%20p-id='1658'%3e%3c/path%3e%3c/svg%3e",import.meta.url).href,lightLux:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1736960509885'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='1818'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='320'%20height='320'%3e%3cpath%20d='M512%20512m-273.066667%200a273.066667%20273.066667%200%201%200%20546.133334%200%20273.066667%20273.066667%200%201%200-546.133334%200Z'%20fill='%23FFB257'%20p-id='1819'%3e%3c/path%3e%3cpath%20d='M512%201024h-40.96l13.653333-136.533333h68.266667l13.653333%20136.533333h-54.613333z%20m-348.16-136.533333l-54.613333-54.613334L218.453333%20750.933333l40.96%2040.96L163.84%20887.466667z%20m703.146667-6.826667l-95.573334-95.573333%2040.96-40.96%20109.226667%2081.92c-20.48%2013.653333-34.133333%2034.133333-54.613333%2054.613333zM0%20539.306667v-27.306667-47.786667L136.533333%20477.866667v54.613333l-136.533333%206.826667z%20m1024-13.653334l-136.533333-6.826666v-13.653334-47.786666l136.533333-13.653334v81.92zM225.28%20266.24L122.88%20177.493333c20.48-20.48%2040.96-40.96%2061.44-54.613333L273.066667%20225.28c-20.48%2013.653333-34.133333%2027.306667-47.786667%2040.96z%20m566.613333-6.826667l-40.96-40.96L839.68%20109.226667c20.48%2013.653333%2040.96%2034.133333%2054.613333%2054.613333l-102.4%2095.573333zM477.866667%20136.533333l-13.653334-136.533333H546.133333l-6.826666%20136.533333H477.866667z'%20fill='%23FFB257'%20p-id='1820'%3e%3c/path%3e%3c/svg%3e",import.meta.url).href})[e],p0=e=>({clickable:e.status!=="normal",abnormal:e.status!=="normal",[`status-${e.status}`]:!0}),N=e=>e?e.includes("晴")?{icon:W0,color:"#F6A30E"}:e.includes("多云")?{icon:H0,color:"#8FB4FF"}:e.includes("雨")?{icon:R0,color:"#4B9EFF"}:e.includes("阴")?{icon:Y0,color:"#B4C0D3"}:{icon:null,color:null}:{icon:null,color:null},k=p(!1),h0=async()=>{try{const e=_.value.find(r=>r.displayId===y.value);if(!e)return;k.value=!0;const t={id:e.plantId,userId:U.user.id,plantId:e.plantId},a=await D0(t);if(a.data.code==="1"){const r=Z(a.data.data);L0.alert(r,"养护建议",{dangerouslyUseHTMLString:!0,customClass:"advice-dialog",confirmButtonText:"我知道了"})}}catch(e){console.error("获取养护建议失败:",e),N0.error("获取养护建议失败")}finally{k.value=!1}};p(!1),p("");const G=p(null);return H(()=>{var e;if(!((e=G.value)!=null&&e.suggestion))return"";try{const t=JSON.parse(G.value.suggestion);return Z(t.result)}catch{return G.value.suggestion}}),(e,t)=>{const a=m0,r=w0,i=x0,M=g0,d=f0,l=v0;return h(),g("div",j0,[x(d,{class:"monitor-card"},{header:w(()=>[s("div",J0,[t[3]||(t[3]=s("div",{class:"header-left"},[s("img",{src:P0,class:"header-icon",alt:"monitor"}),s("span",{class:"title"},"实时监测数据")],-1)),s("div",Z0,[x(a,{type:"primary",size:"small",onClick:h0,class:"advice-btn",loading:k.value,disabled:k.value},{default:w(()=>[R(c(k.value?"生成建议中...":"一键生成养护建议"),1)]),_:1},8,["loading","disabled"]),s("div",q0,[t[2]||(t[2]=s("span",{class:"selector-label"},"监测花盆:",-1)),x(i,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=o=>m.value=o),class:"pot-select",size:"small",onChange:A},{prefix:w(()=>[s("span",{class:Y(["current-status",{online:S.value==="在线"}])},c(S.value),3)]),default:w(()=>[(h(!0),g(E,null,F(_.value,o=>(h(),j(r,{key:o.id,label:`${o.name}`,value:o.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])])]),default:w(()=>[s("div",K0,[s("div",Q0,[s("div",X0,[t[10]||(t[10]=s("div",{class:"weather-icon"},[s("img",{src:A0,alt:"weather",class:"icon"})],-1)),s("div",e2,[s("div",t2,[s("span",a2,c(v.value.current.temp)+"°",1),s("div",s2,[s("span",o2,c(v.value.current.weather),1),N(v.value.current.weather).icon?(h(),g("img",{key:0,src:N(v.value.current.weather).icon,class:"weather-status-icon",style:J({filter:`brightness(0) invert(1) drop-shadow(0 0 2px ${N(v.value.current.weather).color})`}),alt:"weather"},null,12,i2)):T0("",!0)])]),s("div",l2,[s("div",r2,[t[4]||(t[4]=s("span",{class:"label"},"湿度",-1)),s("span",n2,c(v.value.current.humidity)+"%",1)]),s("div",c2,[t[5]||(t[5]=s("span",{class:"label"},"风向",-1)),s("span",d2,c(v.value.current.windDir),1)])])]),s("div",u2,[t[9]||(t[9]=s("div",{class:"forecast-title"},"未来三天",-1)),(h(!0),g(E,null,F(v.value.forecast,(o,z)=>(h(),g("div",{key:z,class:"forecast-item"},[s("div",p2,[s("span",h2,c(o.date),1)]),s("div",m2,[s("div",v2,[t[6]||(t[6]=s("span",{class:"label"},"白天",-1)),s("span",f2,c(o.dayWeather),1)]),s("div",g2,[t[7]||(t[7]=s("span",{class:"label"},"夜间",-1)),s("span",w2,c(o.nightWeather),1)])]),s("div",x2,[s("div",y2,[s("span",_2,c(o.dayTemp)+"°",1),t[8]||(t[8]=s("span",{class:"divider"},"/",-1)),s("span",M2,c(o.nightTemp)+"°",1)]),s("div",b2,[s("span",D2,"湿度 "+c(o.humidity)+"%",1),s("span",C2,"降水 "+c(o.precip)+"mm",1)])])]))),128))])])]),(h(!0),g(E,null,F(n.value,(o,z)=>(h(),g("div",{key:z,class:Y(["monitor-item",p0(o)]),onClick:W2=>d0(o)},[s("div",z2,[s("div",V2,[s("div",S2,[s("img",{src:u0(z),class:"item-icon",alt:z},null,8,T2),s("span",B2,c(o.label),1)]),x(M,{type:l0(o.status),size:"small",class:"status-tag"},{default:w(()=>[R(c(r0(o.status)),1)]),_:2},1032,["type"])]),s("div",E2,[s("div",F2,[s("span",I2,c(o.value),1),s("span",L2,c(o.unit),1)]),s("div",N2,[s("div",G2,[s("div",{class:"progress",style:J({width:n0(o.value,o.min,o.max)+"%",background:W(o.status)==="success"?"var(--el-color-success)":W(o.status)==="warning"?"var(--el-color-warning)":"var(--el-color-danger)"})},null,4)]),s("span",U2,"最佳范围: "+c(o.range),1)])])]),t[11]||(t[11]=s("div",{class:"item-background"},null,-1))],10,k2))),128))])]),_:1}),x(d,{class:"history-card"},{header:w(()=>[s("div",P2,[t[12]||(t[12]=s("div",{class:"header-left"},[s("span",{class:"title"},"历史环境数据")],-1)),x(i,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=o=>b.value=o),class:"data-type-select",size:"small",placeholder:"选择数据类型"},{default:w(()=>[(h(),g(E,null,F(P,o=>x(r,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])]),default:w(()=>[V.value.length?(h(),g("div",A2)):(h(),j(l,{key:0,description:"没有数据","image-size":200}))]),_:1})])}}},n3=C0(O2,[["__scopeId","data-v-e0060a12"]]);export{n3 as default};
