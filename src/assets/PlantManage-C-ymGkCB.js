import{G as $,aA as q,ar as z,E as G,d as H}from"./el-button-BPh_G9Ns.js";import{v as J}from"./el-loading-BBAA0u1d.js";import{E as K}from"./el-dialog-DeciRpM7.js";import"./el-overlay-zVvDA8t1.js";import{a as Q,E as W}from"./el-form-item-Dvi8za3X.js";import"./el-scrollbar-ViEF51Jw.js";import{E as X,a as Y}from"./el-select-D-jhMQjF.js";import{E as Z}from"./el-card-WJRpVXyY.js";import{E as ee,a as ae}from"./el-table-column-Bx-Y-Ma9.js";import"./el-tooltip-l0sNRNKZ.js";import{E as te}from"./el-empty-CTH9Xt6a.js";import{a as le,d as oe,u as ne,b as se}from"./plantinstance-DQ3wuTUO.js";import{g as re}from"./plant-rIoRMkY5.js";import{_ as de,h as ie,g as r,A as ce,a as x,j as a,w as t,o as u,i as E,u as w,l as m,O as pe,b as k,e as ue,F as me,k as fe}from"./index-DoZiZmvY.js";import{E as d}from"./index-DA3cOSt1.js";import{E as _e}from"./index-CZqMsCSa.js";import"./index-Jp57_oih.js";import"./index-CBLBCCTW.js";import"./index-C6vTP1ry.js";import"./_initCloneObject-DTD4hlhT.js";import"./isEqual-CGCEJ5oO.js";import"./validator-CEVNRv68.js";const ve={class:"plant-manage"},ge={class:"card-header"},ye={class:"dialog-footer"},Ie={__name:"PlantManage",setup(be){const f=ie(),v=r([]),i=r(!1),g=r("新增植物"),y=r(""),s=r({userId:f.user.id,plantId:"",id:""}),C={plantId:[{required:!0,message:"请选择植物种类",trigger:"change"}]},I=r(null),P=r([]),b=r(!1),_=async()=>{try{b.value=!0;const o=await re({pageNum:1,pageSize:1e3,search:""});o.data.code==="1"&&(P.value=o.data.data.records.map(l=>({value:l.id,label:l.name})));const e=await le(f.user.id);e.data.code==="1"&&(v.value=e.data.data.map(l=>({id:l.id,plantId:l.plantId,plantName:l.plantName,location:l.location,deviceName:l.deviceName,datePlanted:l.datePlanted})))}catch{d.error("获取植物列表失败")}finally{b.value=!1}},N=()=>{g.value="新增植物",s.value={userId:f.user.id,plantId:"",id:""},i.value=!0},V=o=>{g.value="编辑植物",s.value={id:o.id,ip:y.value,plantId:o.plantId,userId:f.user.id},i.value=!0},h=async o=>{try{await _e.confirm("确认删除该植物?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await oe(o.id),d.success("删除成功"),_()}catch(e){e!=="cancel"&&d.error("删除失败")}},B=async()=>{I.value&&await I.value.validate(async o=>{if(o)try{if(s.value.id){const e={id:s.value.id,plantId:s.value.plantId,ip:s.value.ip};(await ne(e)).data.code==="1"?(d.success("修改成功"),i.value=!1,_()):d.error("修改失败")}else{const e={...s.value,datePlanted:new Date().toISOString().slice(0,19).replace("T"," ")};(await se(e)).data.code==="1"?d.success("新增成功"):d.error("新增失败")}i.value=!1,_()}catch{d.error("操作失败")}})},D=async()=>{try{const e=await(await fetch("http://ip-api.com/json")).json();y.value=e.query}catch(o){console.error("获取IP地址失败:",o),y.value="127.0.0.1"}};return ce(async()=>{await D(),_()}),(o,e)=>{const l=G,c=H,T=te,p=ee,S=ae,F=Z,M=X,L=Y,O=Q,R=W,U=K,j=J;return u(),x("div",ve,[a(F,{class:"plant-card"},{header:t(()=>[E("div",ge,[e[4]||(e[4]=E("span",{class:"title"},"我的绿植",-1)),a(c,{type:"primary",onClick:N},{default:t(()=>[a(l,null,{default:t(()=>[a(w($))]),_:1}),e[3]||(e[3]=m("新增植物 "))]),_:1})])]),default:t(()=>[pe((u(),k(S,{data:v.value,border:"",stripe:"",style:{width:"100%"},"element-loading-text":"加载中...","element-loading-background":"rgba(255, 255, 255, 0.9)"},{default:t(()=>[v.value.length?ue("",!0):(u(),k(T,{key:0,description:"暂无植物数据"})),a(p,{prop:"plantName",label:"植物名称",align:"center"}),a(p,{prop:"deviceName",label:"设备",align:"center"}),a(p,{prop:"location",label:"位置",align:"center"}),a(p,{prop:"datePlanted",label:"种植日期",align:"center",width:"180"}),a(p,{label:"操作",width:"200",align:"center"},{default:t(({row:n})=>[a(c,{type:"primary",link:"",onClick:A=>V(n)},{default:t(()=>[a(l,null,{default:t(()=>[a(w(q))]),_:1}),e[5]||(e[5]=m("编辑 "))]),_:2},1032,["onClick"]),a(c,{type:"danger",link:"",onClick:A=>h(n)},{default:t(()=>[a(l,null,{default:t(()=>[a(w(z))]),_:1}),e[6]||(e[6]=m("删除 "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,b.value]])]),_:1}),a(U,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=n=>i.value=n),title:g.value,width:"500px","destroy-on-close":"","close-on-click-modal":!1,class:"plant-dialog"},{footer:t(()=>[E("div",ye,[a(c,{onClick:e[1]||(e[1]=n=>i.value=!1)},{default:t(()=>e[7]||(e[7]=[m("取消")])),_:1}),a(c,{type:"primary",onClick:B},{default:t(()=>e[8]||(e[8]=[m("确定")])),_:1})])]),default:t(()=>[a(R,{ref_key:"formRef",ref:I,model:s.value,rules:C,"label-width":"100px",class:"plant-form"},{default:t(()=>[a(O,{label:"植物种类",prop:"plantId"},{default:t(()=>[a(L,{modelValue:s.value.plantId,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value.plantId=n),placeholder:"请选择植物种类",style:{width:"100%"},"popper-class":"plant-select-dropdown"},{default:t(()=>[(u(!0),x(me,null,fe(P.value,n=>(u(),k(M,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},qe=de(Ie,[["__scopeId","data-v-3fe5abe4"]]);export{qe as default};
